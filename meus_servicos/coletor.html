<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../meus_servicos/styles/style-servicos-coletor.css">
    <link rel="shortcut icon" href="../logos/favicon.png" type="image/x-icon">
    <title>Meus Serviços</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&display=swap');
    </style>
</head>

<body>
    <header class="cabecalho">
        <nav class="cabecalho-menu">
            <a href="../home/home.html" class="inicio">Início</a>
            <a href="../material/materiais.html" class="como-descartar">Como <br />Descartar</a>
            <a href="../meus_servicos/coletor.html" class="como-descartar" style="color: #414B3B;">Meus Serviços</a>
            <a href="../minhas_coletas/coletor.html" class="como-descartar">Minhas Coletas</a>
            <a href="../perfis/coletor.html" class="como-descartar">Perfil</a>
            <a href="../login/login-teste.html" class="login">Sair</a>
        </nav>

    </header>

    <main>
        <div id="perfil">
            <h1>Meus <br>Serviços</h1>
        </div>
        <section class="cadastro">
            <form id="card-servico">
                <h3>Cadastre seu serviço</h3>
                <div class="campos-forms">
                    <label for="horarioAtendimento">Dia e Horário<span>*</span></label>
                    <input type="text" name="horario" id="horarioAtendimento"
                        placeholder="Exemplo: Seg-Sex: 7:00 às 11:00" required>
                </div>
                <div class="campos-forms">
                    <label for="categoria">Categoria de material<span>*</span></label>
                    <select name="categoria" id="categoria" required>
                        <option value="">Selecione...</option>
                        <option value="Plástico">Plástico</option>
                        <option value="Vidro">Vidro</option>
                        <option value="Papel">Papel</option>
                        <option value="Metal">Metal</option>
                        <option value="Orgânico">Orgânico</option>
                    </select>
                </div>
                <div class="campos-forms">
                    <label>Tipo de entrega<span>*</span></label>
                    <div id="escolher-entrega">
                        <input type="checkbox" name="entrega" id="recolher">
                        <label for="entrega" style="width: 31%;">Recolher em domicílio</label>

                        <input type="checkbox" name="entrega" id="receber">
                        <label for="entrega" style="width: 27%;">Receber no local</label>

                        <div class="info">
                            <div class="button">
                                <span id="button-info">?</span>
                            </div>
                            <div class="info-texto">
                                <span>Marque <b class="texto">"Recolher em domicílio"</b> caso você aceite ir até a
                                    residência do cliente para recolher o material a ser coletado.
                                    <br><br>
                                    Marque <b class="texto">"Receber no local"</b> se você permite que o cliente vá até
                                    o seu encontro para
                                    entregar o material a ser coletado.
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="campos-forms">
                    <label for="descricao">Descrição<span>*</span></label>
                    <textarea name="descricao" id="descricao" required
                        placeholder="Digite aqui os materiais que se incluem neste serviço, além de outras informações que achar pertinente."></textarea>
                </div>
                <div>
                    <p><span>*</span> Campos de preenchimento obrigatório.</p>
                </div>
                <div id="button-servico">
                    <button type="submit">Cadastrar serviço</button>
                </div>
            </form>
        </section>
        <section class="listagem">
            <div id="card-confirmacao">
                <div></div>
                <div id="confirmacao" class="hidden">
                    <p>Confirma a exclusão deste serviço? Os dados dele serão perdidos.</p>
                    <div>
                        <button type="button" id="editar"
                            onClick="(() => {document.getElementById('fundo-modal').classList.add('hidden'); document.getElementById('confirmacao').classList.add('hidden')})()">Cancelar</button>
                        <button type="button" id="excluir" class="excluir" onclick="excluirServico()">Excluir</button>
                    </div>
                </div>
            </div>
            <div class="cards-listagem">
                <div class="servico hidden" id="servico0">
                    <span id="categoria_card0"></span>

                    <input type="text" name="horario" id="dia_horario_card0" placeholder="Horário de coletagem"
                        disabled>
                    <textarea name="descricao" id="descricao_card0" placeholder="Descrição do serviço"
                        disabled></textarea>
                    <div>
                        <div>
                            <input type="checkbox" name="entrega" id="recolher_card0" disabled>
                            <label for="entrega" style="width: 31%;">Recolher em domicílio</label>
                        </div>
                        <div>
                            <input type="checkbox" name="entrega" id="receber_card0" disabled>
                            <label for="entrega" style="width: 27%;">Receber no local</label>
                        </div>
                    </div>


                    <div class="botoes">
                        <button type="button" class="editar0" onclick="habilitaEdicao(0)">Editar</button>
                        <button type="button" class="excluir" onclick="abreConfirmacao()">Excluir</button>
                    </div>
                </div>

                <div class="servico hidden" id="servico1">
                    <span id="categoria_card1"></span>
                    <input type="text" name="horario" id="dia_horario_card1" placeholder="Horário de coletagem"
                        disabled>
                    <textarea name="descricao" id="descricao_card1" placeholder="Descrição do serviço"
                        disabled></textarea>
                    <div>
                        <div>
                            <input type="checkbox" name="entrega" id="recolher_card1" disabled>
                            <label for="entrega" style="width: 31%;">Recolher em domicílio</label>
                        </div>
                        <div>
                            <input type="checkbox" name="entrega" id="receber_card1" disabled>
                            <label for="entrega" style="width: 27%;">Receber no local</label>
                        </div>
                    </div>
                    <div class="botoes">
                        <button type="button" class="editar1" onclick="habilitaEdicao(1)">Editar</button>
                        <button type="button" class="excluir" onclick="abreConfirmacao()">Excluir</button>
                    </div>
                </div>

                <div class="servico hidden" id="servico2">
                    <span id="categoria_card2"></span>
                    <input type="text" name="horario" id="dia_horario_card2" placeholder="Horário de coletagem"
                        disabled>
                    <textarea name="descricao" id="descricao_card2" placeholder="Descrição do serviço"
                        disabled></textarea>
                    <div>
                        <div>
                            <input type="checkbox" name="entrega" id="recolher_card2" disabled>
                            <label for="entrega" style="width: 31%;">Recolher em domicílio</label>
                        </div>
                        <div>
                            <input type="checkbox" name="entrega" id="receber_card2" disabled>
                            <label for="entrega" style="width: 27%;">Receber no local</label>
                        </div>
                    </div>
                    <div class="botoes">
                        <button type="button" class="editar2" onclick="habilitaEdicao(2)">Editar</button>
                        <button type="button" class="excluir" onclick="abreConfirmacao()">Excluir</button>
                    </div>
                </div>

                <div class="servico hidden" id="servico3">
                    <span id="categoria_card3"></span>
                    <input type="text" name="horario" id="dia_horario_card3" placeholder="Horário de coletagem"
                        disabled>
                    <textarea name="descricao" id="descricao_card3" placeholder="Descrição do serviço"
                        disabled></textarea>
                    <div>
                        <div>
                            <input type="checkbox" name="entrega" id="recolher_card3" disabled>
                            <label for="entrega" style="width: 31%;">Recolher em domicílio</label>
                        </div>
                        <div>
                            <input type="checkbox" name="entrega" id="receber_card3" disabled>
                            <label for="entrega" style="width: 27%;">Receber no local</label>
                        </div>
                    </div>
                    <div class="botoes">
                        <button type="button" class="editar3" onclick="habilitaEdicao(3)">Editar</button>
                        <button type="button" class="excluir" onclick="abreConfirmacao()">Excluir</button>
                    </div>
                </div>

                <div class="servico hidden" id="servico4">
                    <span id="categoria_card4"></span>
                    <input type="text" name="horario" id="dia_horario_card4" placeholder="Horário de coletagem"
                        disabled>
                    <textarea name="descricao" id="descricao_card4" placeholder="Descrição do serviço"
                        disabled></textarea>
                    <div>
                        <div>
                            <input type="checkbox" name="entrega" id="recolher_card4" disabled>
                            <label for="entrega" style="width: 31%;">Recolher em domicílio</label>
                        </div>
                        <div>
                            <input type="checkbox" name="entrega" id="receber_card4" disabled>
                            <label for="entrega" style="width: 27%;">Receber no local</label>
                        </div>
                    </div>
                    <div class="botoes">
                        <button type="button" class="editar4" onclick="habilitaEdicao(4)">Editar</button>
                        <button type="button" class="excluir" onclick="abreConfirmacao()">Excluir</button>
                    </div>
                </div>

                <div class="servico hidden" id="servico5">
                    <span id="categoria_card5"></span>
                    <input type="text" name="horario" id="dia_horario_card5" placeholder="Horário de coletagem"
                        disabled>
                    <textarea name="descricao" id="descricao_card5" placeholder="Descrição do serviço"
                        disabled></textarea>
                    <div>
                        <div>
                            <input type="checkbox" name="entrega" id="recolher_card5" disabled>
                            <label for="entrega" style="width: 31%;">Recolher em domicílio</label>
                        </div>
                        <div>
                            <input type="checkbox" name="entrega" id="receber_card5" disabled>
                            <label for="entrega" style="width: 27%;">Receber no local</label>
                        </div>
                    </div>
                    <div class="botoes">
                        <button type="button" class="editar5" onclick="habilitaEdicao(5)">Editar</button>
                        <button type="button" class="excluir" onclick="abreConfirmacao()">Excluir</button>
                    </div>
                </div>
            </div>

        </section>
    </main>

    <div id="fundo-modal" class="hidden"
        onClick="(() => {document.getElementById('fundo-modal').classList.add('hidden'); document.getElementById('confirmacao').classList.add('hidden')})()">
    </div>


    <footer class="rodape">
        <p class="rodape-texto">Recicle.me</p>
        <img class="rodape-img" src="../logos/logosvg.svg" alt="LogoRecicleME">
    </footer>




    <!-- <script src="../meus_servicos/funcionalidades.js"></script> -->

    <script>

        var cardForm = document.getElementById("card-servico");
        const servicosArray = JSON.parse(localStorage.getItem('servicos'));

        // Faz o cadastro de serviços
        cardForm.addEventListener("submit", (e) => {
            e.preventDefault();

            var categoria = document.getElementById("categoria").value;
            var horario_atendimento = document.getElementById("horarioAtendimento").value;
            var escolher_recolher = document.getElementById("recolher").checked;
            var escolher_receber = document.getElementById("receber").checked;
            var descricao = document.getElementById("descricao").value;
            //var categoriaEscolhida = document.getElementById("categoria")

            // (categoria.options[categoria.selectedIndex].value != "")

            console.log(horario_atendimento);
            console.log(categoria);
            console.log(escolher_recolher);
            console.log(escolher_receber);
            console.log(descricao);

            if (horario_atendimento && descricao && (escolher_receber || escolher_recolher) && (categoria != null)) {
                var servicos = new Array();

                if (localStorage.hasOwnProperty("servicos")) {
                    //Recuperar os valores de serviços
                    //Converte de String para Object
                    servicos = JSON.parse(localStorage.getItem("servicos"));
                }

                // Adiciona um novo objetivo no array criado
                servicos.push({ categoria, horario_atendimento, escolher_recolher, escolher_receber, descricao });

                // Salvar no LocalStorage
                localStorage.setItem("servicos", JSON.stringify(servicos));

                // Recuperar as informações
                const servico_localstorage = localStorage.getItem("servicos");
                console.log(servico_localstorage);

                // Converte a string JSON em um objeto JavaScript
                var dados_servico = JSON.parse(servico_localstorage);
                console.log(dados_servico);

                alert("Sucesso! Serviço cadastrado.")

                window.location.reload();
            } else {
                alert("Ops! Necessário preencher todos os campos obrigatórios para prosseguir.")
            }
        });


        // Verificar se o dado existe, e se existir, mostra ele nos cards de serviços cadastrados
        if (servicosArray && servicosArray.length > 0) {
            for (let i = 0; i < servicosArray.length; i++) {
                const unidadeArray = servicosArray[i];

                const cardServicoAtual = document.getElementById(`servico${i}`);
                cardServicoAtual.classList.remove("hidden");

                // Inserir o dado no input
                document.getElementById(`categoria_card${i}`).innerText = servicosArray[i].categoria;
                document.getElementById(`dia_horario_card${i}`).value = servicosArray[i].horario_atendimento;
                document.getElementById(`descricao_card${i}`).innerText = servicosArray[i].descricao;


                if (servicosArray[i].escolher_recolher === true) {
                    document.getElementById(`recolher_card${i}`).checked = true;
                } else {
                    document.getElementById(`recolher_card${i}`).checked = false;
                }

                if (servicosArray[i].escolher_receber === true) {
                    document.getElementById(`receber_card${i}`).checked = true;
                } else {
                    document.getElementById(`receber_card${i}`).checked = false;
                }
            }
        }


        // Habilita os botões de edição
        function habilitaEdicao(numero) {
            const editarButton = document.querySelector(`.editar${numero}`);

            if (numero === 0) {
                if (editarButton.innerText === "Editar") {
                    document.getElementById('dia_horario_card0').disabled = false;
                    document.getElementById('descricao_card0').disabled = false;
                    document.getElementById('recolher_card0').disabled = false;
                    document.getElementById('receber_card0').disabled = false;
                    document.querySelector(".editar0").innerText = "Salvar";

                    document.getElementById("dia_horario_card0").classList.add("modoEdicao");
                    document.getElementById("descricao_card0").classList.add("modoEdicao");
                } else if (editarButton.innerText === "Salvar") {
                    salvarDados(numero);
                    document.getElementById('dia_horario_card0').disabled = true;
                    document.getElementById('descricao_card0').disabled = true;
                    document.getElementById('recolher_card0').disabled = true;
                    document.getElementById('receber_card0').disabled = true;
                    document.querySelector(".editar0").innerText = "Editar";

                    document.getElementById("dia_horario_card0").classList.remove("modoEdicao");
                    document.getElementById("descricao_card0").classList.remove("modoEdicao");
                }


            } else if (numero === 1) {
                if (editarButton.innerText === "Editar") {
                    document.getElementById('dia_horario_card1').disabled = false;
                    document.getElementById('descricao_card1').disabled = false;
                    document.getElementById('recolher_card1').disabled = false;
                    document.getElementById('receber_card1').disabled = false;
                    document.querySelector(".editar1").innerText = "Salvar";

                    document.getElementById("dia_horario_card1").classList.add("modoEdicao");
                    document.getElementById("descricao_card1").classList.add("modoEdicao");
                } else if (editarButton.innerText === "Salvar") {
                    document.getElementById('dia_horario_card1').disabled = true;
                    document.getElementById('descricao_card1').disabled = true;
                    document.getElementById('recolher_card1').disabled = true;
                    document.getElementById('receber_card1').disabled = true;
                    document.querySelector(".editar1").innerText = "Editar";

                    document.getElementById("dia_horario_card1").classList.remove("modoEdicao");
                    document.getElementById("descricao_card1").classList.remove("modoEdicao");
                }

            } else if (numero === 2) {
                if (editarButton.innerText === "Editar") {
                    document.getElementById('dia_horario_card2').disabled = false;
                    document.getElementById('descricao_card2').disabled = false;
                    document.getElementById('recolher_card2').disabled = false;
                    document.getElementById('receber_card2').disabled = false;
                    document.querySelector(".editar2").innerText = "Salvar";

                    document.getElementById("dia_horario_card2").classList.add("modoEdicao");
                    document.getElementById("descricao_card2").classList.add("modoEdicao");
                } else if (editarButton.innerText === "Salvar") {
                    document.getElementById('dia_horario_card2').disabled = true;
                    document.getElementById('descricao_card2').disabled = true;
                    document.getElementById('recolher_card2').disabled = true;
                    document.getElementById('receber_card2').disabled = true;
                    document.querySelector(".editar2").innerText = "Editar";

                    document.getElementById("dia_horario_card2").classList.remove("modoEdicao");
                    document.getElementById("descricao_card2").classList.remove("modoEdicao");
                }

            } else if (numero === 3) {
                if (editarButton.innerText === "Editar") {
                    document.getElementById('dia_horario_card3').disabled = false;
                    document.getElementById('descricao_card3').disabled = false;
                    document.getElementById('recolher_card3').disabled = false;
                    document.getElementById('receber_card3').disabled = false;
                    document.querySelector(".editar3").innerText = "Salvar";

                    document.getElementById("dia_horario_card3").classList.add("modoEdicao");
                    document.getElementById("descricao_card3").classList.add("modoEdicao");
                } else if (editarButton.innerText === "Salvar") {
                    document.getElementById('dia_horario_card3').disabled = true;
                    document.getElementById('descricao_card3').disabled = true;
                    document.getElementById('recolher_card3').disabled = true;
                    document.getElementById('receber_card3').disabled = true;
                    document.querySelector(".editar3").innerText = "Editar";

                    document.getElementById("dia_horario_card3").classList.remove("modoEdicao");
                    document.getElementById("descricao_card3").classList.remove("modoEdicao");
                }
            } else if (numero === 4) {
                if (editarButton.innerText === "Editar") {
                    document.getElementById('dia_horario_card4').disabled = false;
                    document.getElementById('descricao_card4').disabled = false;
                    document.getElementById('recolher_card4').disabled = false;
                    document.getElementById('receber_card4').disabled = false;
                    document.querySelector(".editar4").innerText = "Salvar";

                    document.getElementById("dia_horario_card4").classList.add("modoEdicao");
                    document.getElementById("descricao_card4").classList.add("modoEdicao");
                } else if (editarButton.innerText === "Salvar") {
                    document.getElementById('dia_horario_card4').disabled = true;
                    document.getElementById('descricao_card4').disabled = true;
                    document.getElementById('recolher_card4').disabled = true;
                    document.getElementById('receber_card4').disabled = true;
                    document.querySelector(".editar4").innerText = "Editar";

                    document.getElementById("dia_horario_card4").classList.remove("modoEdicao");
                    document.getElementById("descricao_card4").classList.remove("modoEdicao");
                }
            } else if (numero === 5) {
                if (editarButton.innerText === "Editar") {
                    document.getElementById('dia_horario_card5').disabled = false;
                    document.getElementById('descricao_card5').disabled = false;
                    document.getElementById('recolher_card5').disabled = false;
                    document.getElementById('receber_card5').disabled = false;
                    document.querySelector(".editar5").innerText = "Salvar";

                    document.getElementById("dia_horario_card5").classList.add("modoEdicao");
                    document.getElementById("descricao_card5").classList.add("modoEdicao");
                } else if (editarButton.innerText === "Salvar") {
                    document.getElementById('dia_horario_card5').disabled = true;
                    document.getElementById('descricao_card5').disabled = true;
                    document.getElementById('recolher_card5').disabled = true;
                    document.getElementById('receber_card5').disabled = true;
                    document.querySelector(".editar5").innerText = "Editar";

                    document.getElementById("dia_horario_card5").classList.remove("modoEdicao");
                    document.getElementById("descricao_card5").classList.remove("modoEdicao");
                }
            }
        }

        // Abre modal de confirmação de exclusão
        function abreConfirmacao() {
            const modal = document.getElementById("confirmacao");
            const fundo = document.getElementById("fundo-modal");

            modal.classList.remove("hidden");
            fundo.classList.remove("hidden");
        }



        function editarServico() {
            // Recuperar o array do localStorage e convertê-lo de volta para um array
            const usuariosString = localStorage.getItem('servicos');
            const usuariosArray = JSON.parse(usuariosString);

            // Verificar se o array existe
            if (usuariosArray) {
                // Pegar o ID a ser alterado do input
                const idParaAlterar = parseInt(document.getElementById('idParaAlterar').value, 10);

                // Pegar o novo nome do input
                const novoNome = document.getElementById('novoNome').value;

                // Encontrar o índice do objeto a ser alterado
                const index = usuariosArray.findIndex(usuario => usuario.id === idParaAlterar);

                // Se o objeto existir no array, alterá-lo
                if (index !== -1) {
                    usuariosArray[index].nome = novoNome;

                    // Armazenar o array atualizado de volta no localStorage
                    localStorage.setItem('usuarios', JSON.stringify(usuariosArray));

                    // Informar o usuário que o objeto foi alterado
                    alert(`O usuário com ID ${idParaAlterar} foi alterado para ${novoNome}.`);
                } else {
                    alert(`O usuário com ID ${idParaAlterar} não foi encontrado.`);
                }
            }
        }

        function salvarDados(id) {
            // var nome_coletor = document.getElementById("nome").value;
            // var cnpj_coletor = document.getElementById("cnpj").value;
            // var email_coletor = document.getElementById("email").value;
            // var telefone_coletor = document.getElementById("telefone").value;
            // var logradouro_coletor = document.getElementById("rua").value;
            // var numero_coletor = document.getElementById("numero").value;
            // var bairro_coletor = document.getElementById("bairro").value;
            // var cidade_coletor = document.getElementById("cidade").value;
            // var estado_coletor = document.getElementById("estado").value;

            alert(id);
            // var novo_horario_atendimento = document.getElementById(`dia_horario_card${id}`).value;
            // var novo_escolher_recolher = document.getElementById(`recolher_card${id}`).checked;
            // var novo_escolher_receber = document.getElementById(`receber_card${id}`).checked;
            // var nova_descricao = document.getElementById(`descricao_card${id}`).value;

            //document.getElementById('dia_horario_card0').disabled = false;
                    //document.getElementById('descricao_card0').disabled = false;
                    //document.getElementById('recolher_card0').disabled = false;
                    //document.getElementById('receber_card0').disabled = false;

            // let servicos = new Array();
        
            // if(localStorage.hasOwnProperty("servicos")){
            //     servicos = JSON.parse(localStorage.getItem("servicos"));
            // }
        
            // servicos.push({ novo_horario_atendimento, novo_escolher_recolher, novo_escolher_receber, nova_descricao });
        
            // localStorage.setItem("servicos", JSON.stringify(servicos));
        }








        function excluirServico() {

            // Recuperar o array do localStorage e convertê-lo de volta para um array
            const servicosArray2 = JSON.parse(localStorage.getItem('servicos'));
            console.log(servicosArray2);

            // Verificar se o array existe
            if (servicosArray2) {
                // Pegar o nome a ser excluído do input
                const servicoParaExcluir = document.getElementById('categoria').value;
                console.log(servicoParaExcluir);

                // Encontrar o índice do item a ser excluído
                const index = servicosArray2.indexOf(servicoParaExcluir);

                // Se o item existir no array, removê-lo
                if (index !== -1) {
                    servicosArray2.splice(index, 1);

                    // Armazenar o array atualizado de volta no localStorage
                    localStorage.setItem('usuarios', JSON.stringify(servicosArray2));

                    // Informar o usuário que o item foi excluído
                    alert(`O serviço da categoria ${servicoParaExcluir} foi excluído.`);
                } else {
                    alert(`O serviço de ${servicoParaExcluir} não foi encontrado.`);
                }
            }
        }
    </script>
</body>

</html>